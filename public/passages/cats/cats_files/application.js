(function(){var NewselaApplication,ref,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};NewselaApplication=function(){function NewselaApplication(){this.initialize_popovers=bind(this.initialize_popovers,this),this.initialize_widgets=bind(this.initialize_widgets,this),window.App=this,this.initialize_filters(),this.initialize_widgets("body"),this.initialize_masthead(),this.initialize_popovers(),this.initialize_signout()}return NewselaApplication.prototype.API_ROOT=window.API_BASE_URL,NewselaApplication.prototype.domain={},NewselaApplication.prototype.model={},NewselaApplication.prototype.initialize_widgets=function(root){var $root,offset,ref;return $root=$(root),$root.find(".has-tooltip").tooltip(),$root.find(".has-popover").popover().each(function(){var popover_class;if(popover_class=$(this).data("popover-class"))return $(this).data("bs.popover").tip().addClass(popover_class)}),$root.find("input[type=text][placeholder]").placeholder(),offset=(new Date).getTimezoneOffset(),$root.find("#id_timezone").val(offset),$(".has-tooltip",$root).tooltip(),$("input[type=text][placeholder]",$root).placeholder(),$root.find(".anchor-standard").popover({trigger:"hover",container:"body",html:!0,content:function(){var class_name,full_title,i,len,match,matches,pattern,reading_standards,results,standard,standards;for(reading_standards="cc",pattern=new RegExp("^reading-standard-("+reading_standards+".+)$"),matches=function(){var i,len,ref,results;for(ref=this.className.split(/\s+/),results=[],i=0,len=ref.length;i<len;i++)class_name=ref[i],results.push(pattern.exec(class_name));return results}.call(this),standards=function(){var i,len,results;for(results=[],i=0,len=matches.length;i<len;i++)match=matches[i],match&&results.push(READING_STANDARDS[match[1]]);return results}(),results=[],i=0,len=standards.length;i<len;i++)standard=standards[i],full_title=standard.label+": "+standard.title,results.push("<b>"+full_title+"</b><p>"+standard.description+"</p>");return results}}),"undefined"!=typeof twttr&&null!==twttr&&null!=(ref=twttr.widgets)&&ref.load($root.get(0)),$(".social-button").on("click",function(){return $(this).addClass("shared")}),$(".tag-widget").each(function(){var $input,$widget,header_id,suggestion_engine,tags;return $widget=$(this),tags=$widget.find(".tag").map(function(){return $(this).text()}),header_id=$widget.closest("#ArticleHeader[data-id]").attr("data-id"),$input=$widget.find("input[type=text]"),suggestion_engine=new Bloodhound({datumTokenizer:function(tag){return Bloodhound.tokenizers.whitespace(tag.value)},queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:App.API_ROOT+"/articletag/?include_knowledge_tips=true",cacheKey:"articletag",filter:function(response){return response}}}),suggestion_engine.initialize(),$input.off().typeahead({hint:!1},{source:suggestion_engine.ttAdapter(),templates:{suggestion:function(tag){var format,tip;return format=tag.value,tag.knowledge_tips.length>0&&(format='<span class="fa fa-sticky-note-o pull-left tag-tip-icon" aria-hidden="true"></span><strong>'+tag.value+"</strong>",format+='<div class="tip-titles">Associated Knowledge Tips:<br>',format+="<ul><li>",format+=[].concat(function(){var i,len,ref1,results;for(ref1=tag.knowledge_tips,results=[],i=0,len=ref1.length;i<len;i++)tip=ref1[i],results.push(tip.title);return results}()).join("<li>"),format+="</ul></div>"),format}}}).on("keydown",function(e){var $tag,ref1,tag;if(13===e.keyCode&&(tag={value:$(this).val()},ref1=tag.value,!(indexOf.call(tags,ref1)>=0)))return $tag=$("<span />").text(tag.value).addClass("tag"),$.ajax({url:""+App.API_ROOT+("/articleheader/"+header_id+"/tag"),type:"POST",headers:{"X-CSRFToken":csrf_token},contentType:"application/json",data:JSON.stringify(tag),success:function(){if($widget.find(".tags").append($tag),$input.val(""),suggestion_engine.clearPrefetchCache(),"sensitive-content"===tag.value)return $(".sensitive_content_warning").removeClass("hidden")},error:function(){return $widget.addClass("error")}})}),$widget.on("click",".tags .tag a.delete",function(){var $tag,value;return $tag=$(this).closest(".tag"),value=$.trim($tag.text()),$.ajax({url:App.API_ROOT+"/articleheader/"+header_id+"/tag/"+value,type:"DELETE",headers:{"X-CSRFToken":csrf_token},success:function(){return $tag.remove(),$(".sensitive_content_warning").addClass("hidden")}})})}),$(".newsela-like-button-jquery").on("click",function(){var $button,$like_count_span,data,id,is_authenticated,like_count,like_id,ref1,ref2,ref3,ref4,url;return is_authenticated=!!$(".User.current-user").data("id"),is_authenticated?!window.article_like_in_progress==!0?(window.article_like_in_progress=!0,$button=$(this),id=null!=(ref1=null!=(ref2=$button.closest(".Article").data())?ref2.id:void 0)?ref1:null!=(ref3=$("#Article").data())?ref3.id:void 0,$like_count_span=$button.find("span.like-count"),like_count=parseInt($like_count_span.text(),10),(null!=(ref4=$button.data())?ref4.id:void 0)?($like_count_span.text(--like_count),$button.removeClass("activated"),like_id=$button.data().id,url=App.API_ROOT+"/articlelike/"+like_id+"/","text-set"===$button.data().type&&(url=App.API_ROOT+"/text-set-like/"+like_id+"/"),$.ajax({type:"DELETE",url:url,success:function(){return $button.data({id:null}),"function"==typeof ga?ga("send","event","button","click","Article Unlike"):void 0},error:function(){return $button.addClass("activated")},complete:function(){return window.article_like_in_progress=!1}})):($like_count_span.text(++like_count),$button.addClass("activated"),"text-set"===$button.data().type?(url="#{ App.API_ROOT }/text-set-like/",data=JSON.stringify({text_set_id:id})):(url="/api/v2/articlelike/",data=JSON.stringify({article_id:id})),$.ajax({type:"POST",url:url,contentType:"application/json",data:data,success:function(like){return $button.data({id:like.id}),"function"==typeof ga?ga("send","event","button","click","Article Like"):void 0},error:function(){return $button.removeClass("activated"),$like_count_span.text(--like_count)},complete:function(){return window.article_like_in_progress=!1}}))):void 0:void $("#signin-modal").modal("show")})},NewselaApplication.prototype.initialize_popovers=function(){var popoverRepositionPid;return popoverRepositionPid=null,$(window).on("resize",function(){if(!popoverRepositionPid)return $(".has-popover, .has-popover-manual").each(function(){var ref;if(null!=(ref=$(this).data("bs.popover"))?ref.tip().hasClass("in"):void 0)return popoverRepositionPid=setTimeout(function(_this){return function(){return $(_this).popover("show"),popoverRepositionPid=null}}(this),800)})})},NewselaApplication.prototype.initialize_masthead=function(){var masthead_element,menus;return $("#masthead").length&&(angular.bootstrap("#masthead-nav",["masthead"]),angular.bootstrap("#inset-search",["masthead-search"])),$("#masthead .hamburger").on("click",function(){return $("#masthead").toggleClass("open")}),masthead_element=$("#masthead"),menus=masthead_element.find(".container > nav"),menus.on("mouseenter",function(){return masthead_element.addClass("menu-open")}),menus.on("mouseleave",function(){return masthead_element.removeClass("menu-open")})},NewselaApplication.prototype.initialize_filters=function(){return $(".filters").on("click",".filter-dropdown legend",function(e){var $fieldset,$legend;if(e.preventDefault(),$legend=$(this),$fieldset=$legend.closest("fieldset"),!$legend.is(".disabled")&&!$fieldset.is(".disabled"))return $fieldset.toggleClass("open")}).on("mouseleave","fieldset.filter-dropdown",function(e){return $(e.currentTarget).removeClass("open")}).on("change","fieldset.filter-dropdown li label :checkbox",function(e){var $checkbox,$fieldset;return $checkbox=$(e.target),$fieldset=$checkbox.closest("fieldset"),$fieldset.find("label").removeClass("checked").find(":checkbox").prop("checked",!1),$checkbox.prop("checked",!0).closest("label").addClass("checked"),$checkbox.closest("fieldset").addClass("active").find(".current-value").text($checkbox.attr("data-label")||$checkbox.closest("label").text())}).on("change","fieldset.filter-boolean :checkbox",function(e){var $checkbox;return $checkbox=$(e.target),$checkbox.closest("label").toggleClass("checked",$checkbox.is(":checked")),$checkbox.closest("fieldset").toggleClass("active",$checkbox.is(":checked"))}).on("click","fieldset.filter-dropdown .clear",function(e){var $fieldset;return e.preventDefault(),e.stopPropagation(),$fieldset=$(e.target).closest("fieldset"),$fieldset.find(":checkbox:checked").prop("checked",!1).parent().removeClass("checked"),$fieldset.closest("form").trigger("submit"),$fieldset.removeClass("active").find(".current-value").empty()})},NewselaApplication.prototype.initialize_signout=function(){return $(".signout-link").on("click",function(){return $.ajax({url:App.API_ROOT+"/session/",type:"DELETE",success:function(_this){return function(response,text_status,jqXHR){var location;return location=jqXHR.getResponseHeader("Location"),location?window.location.href=location:window.location.reload()}}(this)})})},NewselaApplication}(),this.NewselaApplication=NewselaApplication,window.csrf_token=null!=(ref=document.cookie.match(/csrftoken=(\w+)/))?ref[1]:void 0,$.ajaxSetup({beforeSend:function(xhr){return xhr.setRequestHeader("X-CSRFToken",window.csrf_token)}})}).call(this);