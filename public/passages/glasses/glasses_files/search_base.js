(function(){var module,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};module=angular.module("newsela-search-base",["newsela-common"]),module.factory("NavPages",function(){var pages,trim;return trim=function(s){return s.replace(/^\s+|\s$/,"")},pages=[],angular.element("#masthead nav nav a").each(function(){var anchor,parts;return anchor=angular.element(this),parts=[],anchor.parents("li").each(function(){return parts.push(trim(angular.element(this).children("a").text()))}),parts.reverse(),pages.push({text:"function"==typeof parts.join?parts.join(" > "):void 0,url:anchor.attr("href"),type:"page"})}),{query:function(filters){var key,page,pages_matching_needle,ref,ref1,value;if(!(null!=(ref=filters.needle)?ref.length:void 0))return[];for(key in filters)if(value=filters[key],"needle"!==key&&"page_size"!==key&&"size"!==key)return[];return pages_matching_needle=function(){var j,len,results1;for(results1=[],j=0,len=pages.length;j<len;j++)page=pages[j],_.includes(page.text.toLowerCase(),filters.needle.toLowerCase())&&results1.push(page);return results1}(),pages_matching_needle.slice(0,null!=(ref1=filters.page_size)?ref1:12)}}}),module.controller("BaseSearchController",function($scope,$rootScope,$timeout,$httpParamSerializer,$location,$q,$window,User,ArticleLike,TextSetLike,ContentSearch,TextSet,NavPages,READING_STANDARDS,STATIC_URL,ARTICLE_LANGUAGES,Filters,IsInsetSearch,Searches,isXsScreen,SearchService,StudySegment,SkipSearches,hasActivePowerWordsLicense,hasActiveProSubscription){var BETA_FILTER_GROUP_NAMES,EDUCATOR_ONLY_FILTERS,FACETS,NEW_FILTERS,default_filters,get_cleaned_filters,get_latest_article_suggestions,get_suggested_results,handle_search_term,is_empty,j,key,len,magnifying_glass,needle_input,nested_val,ref,sanitized_needle,search_labels,send_to_ga,send_to_kinesis,text_set_search_labels,timeout_promise,trigger_search,user_article_likes,user_text_set_likes,value;default_filters={audiences:[],categories:[],content_maturities:[],content_provider:[],facets:[],features:[],format:[],grade_levels:[],language:[],languages:[],needle:[],objects:[],page_size:[],reading_skills:[],required_tag:[],rule:[],subjects:[],story_types:[],tags:[],text_set_types:[]},angular.extend($scope,FACETS=[],{LANGUAGES:ARTICLE_LANGUAGES,STATIC_URL:STATIC_URL,current_date:new Date},user_article_likes=[],user_text_set_likes=[],{convert_cc_to_teks:function(filter_group){var combined_filters,existing_count,f,filter,j,key,len,ref,teks,teks_filters;for(combined_filters={},teks_filters=[],ref=filter_group.filters,j=0,len=ref.length;j<len;j++)f=ref[j],teks=READING_STANDARDS[f.value].maps_to[0],combined_filters[teks]?(existing_count=combined_filters[teks].count,combined_filters[teks].count=f.count+existing_count):combined_filters[teks]={display_name:teks,count:f.count,value:teks};for(key in combined_filters)filter=combined_filters[key],teks_filters.push(filter);filter_group.filters=teks_filters},searches:Searches||[{label:"Collections",query:function(f){return f.objects="text_set",f.format="full",f.facets=!0,SearchService.get(f).$promise.then(function(response){var j,len,ref,result;for(ref=response.results,j=0,len=ref.length;j<len;j++)result=ref[j],result.url="/text-sets/"+result.id+"?new_ui=true",result.like=_.find($scope.user_text_set_likes,{text_set_id:result.id})||{},response.search_id&&(result.search_id=response.search_id),result.display_category?result.category_label=result.display_category:result.category_label=result.object.text_set_type.replace("_"," ");return response.results})},page_size:12,show_all_results:!1,supports_see_all:function(){var ref;return(null!=(ref=$scope.collection_ids)?ref.length:void 0)>0},see_all:function(){var collection_ids;return collection_ids=$scope.collection_ids.join(),$scope.filters.rule?document.location="/text-sets/#/"+$scope.filters.rule+"?collection_ids="+$scope.collection_ids.join():document.location="/text-sets/#/?"+$scope.querystring+"&collection_ids="+$scope.collection_ids.join()},template:'<div class="tile" type="text_set" tile="result" context="search"></div>'},{label:"Articles",query:function(f){return f.objects="header",f.format="full",f.facets=!0,SearchService.get(f).$promise.then(function(response){var filter_group,item,j,len,prefer_teks,ref,ref1,ref2,result;if(null!=(ref=response.aggregations)?ref.facets:void 0){$scope.FACETS=response.aggregations.facets,ref1=$scope.FACETS;for(item in ref1)filter_group=ref1[item],prefer_teks=$scope.user&&"teks"===$scope.user.reading_standards&&"reading_skills"===filter_group.slug,prefer_teks&&$scope.convert_cc_to_teks(filter_group),$scope.filters[filter_group.slug]||($scope.filters[filter_group.slug]=f[filter_group.slug]?f[filter_group.slug]:[])}for(ref2=response.results,j=0,len=ref2.length;j<len;j++)result=ref2[j],result.like=_.find($scope.user_article_likes,{header_id:result.id})||{},response.search_id&&(result.search_id=response.search_id);return response.results})},page_size:12,show_all_results:!1,supports_see_all:function(){return!0},see_all:function(){var ref;return(null!=(ref=$scope.filters.rule)?ref.length:void 0)>0?document.location="/articles/#/rule/"+$scope.filters.rule:document.location="/articles/#/?"+$scope.querystring},template:'<div class="tile" type="header" tile="result" context="search"></div>'},{label:"Text Sets",query:function(f){return null!=f.rule&&"saved-by-me"===f.rule?(delete f.format,f.include_article_headers=!0,f.include_likes=!0,f.include_user_likes=!0,f.types="text_set",TextSet.query(f).$promise):(f.objects="text_set",f.format="full",f.facets=!0,f.text_set_types="text_set",SearchService.get(f).$promise.then(function(response){var j,len,ref,result;for(ref=response.results,j=0,len=ref.length;j<len;j++)result=ref[j],result.like=_.find($scope.user_text_set_likes,{text_set_id:result.id})||{},response.search_id&&(result.search_id=response.search_id);return response.results}))},page_size:12,show_all_results:!1,supports_see_all:function(){return!0},see_all:function(){var ref;return(null!=(ref=$scope.filters.rule)?ref.length:void 0)>0?document.location="/text-sets/#/"+$scope.filters.rule:document.location="/text-sets/#/?"+$scope.querystring},template:'<div class="tile" type="text_set" tile="result" context="search"></div>'},{label:"Pages",query:function(filters){return $q(function(resolve,reject){return resolve(NavPages.query(filters))})},template:'<div class="page">{{result.text}}</div>'}],suggestion_searches:{recently_viewed_articles:{fetched:!1,label:"You Recently Viewed",query:function(){var suggestion_params;return suggestion_params={objects:"header",format:"full",page_size:3,rule:"recently-viewed-by-me"},SearchService.get(suggestion_params).$promise.then(function(response){var j,len,ref,result;for(ref=response.results,j=0,len=ref.length;j<len;j++)result=ref[j],result.like=_.find($scope.user_article_likes,{header_id:result.id})||{},response.search_id&&(result.search_id=response.search_id);return response.results})},template:'<div class="tile" type="header" tile="result" context="search"></div>'},latest_articles:{fetched:!1,label:"Latest Articles",query:function(){var suggestion_params;return suggestion_params={objects:"header",format:"full",page_size:3},SearchService.get(suggestion_params).$promise.then(function(response){var j,len,ref,result;for(ref=response.results,j=0,len=ref.length;j<len;j++)result=ref[j],result.like=_.find($scope.user_article_likes,{header_id:result.id})||{},response.search_id&&(result.search_id=response.search_id);return response.results})},template:'<div class="tile" type="header" tile="result" context="search"></div>'}},filters:angular.extend({},default_filters,Filters),expanded_filters:{},show_all_results:function(){return $window.location="/search/#/?"+$scope.querystring},update_expanded_filters:function(key){var all_values,current_filters,expanded_filters,filter_value,j,l,len,len1,value;if(expanded_filters=[],current_filters=_.cloneDeep($scope.filters[key]),!current_filters)return void(indexOf.call($scope.expanded_filters,key)>=0&&delete $scope.expanded_filters[key]);for(j=0,len=current_filters.length;j<len;j++)if(filter_value=current_filters[j],"string"==typeof filter_value||filter_value instanceof String)for(all_values=filter_value.split(","),l=0,len1=all_values.length;l<len1;l++)value=all_values[l],expanded_filters.push(value);else expanded_filters.push(filter_value);$scope.expanded_filters[key]=expanded_filters},select_result:function(result,$event,event_name,event_description,event_type){var kinesis_properties,navigate_to_result;return null==event_name&&(event_name="search"),null==event_description&&(event_description="Search Result Opened"),null==event_type&&(event_type="click"),$event.target.href&&$event.preventDefault(),navigate_to_result=function(){return $event.target.href?document.location=$event.target.href:"page"===result.type?document.location=result.url:void 0},kinesis_properties={event_description:event_description},"header"===result.type?kinesis_properties.header_id=result.id:kinesis_properties.text_set_id=result.id,result.search_id&&(kinesis_properties.search_id=result.search_id),send_to_kinesis(event_name,event_type,kinesis_properties),send_to_ga(event_name,event_type,event_description),$timeout(navigate_to_result,300)},querystring:"",assign_filter:function(key,value){var base,index,values;return"needle"===key?($scope.filters[key]=value,"needle"!==key||needle_input.val()||needle_input.val(value)):_.isArray($scope.filters[key])?(values=null!=(base=$scope.filters)[key]?base[key]:base[key]=[],value=isNaN(value)?value:Number(value),index=values.indexOf(value),!index>-1&&values.push(value)):(value=isNaN(value)?value:Number(value),$scope.filters[key]=[value]),$scope.update_expanded_filters(key)},toggle_filter:function(key,value,filter){var _is_filtering,added,base,existing_value,existing_values,first_value,first_value_type,index,item,j,l,len,len1,len2,len3,len4,m,n,new_index,new_value,new_value_type,new_values,o,ref,ref1,ref2,ref3,values;if(_is_filtering=$scope.is_filtering(key,value),!filter||0!==filter.count||_is_filtering)if("needle"===key){if($scope.filters[key]=value,"needle"===key&&!needle_input.val())return needle_input.val(value)}else{if(new_values=[],values=_.cloneDeep(null!=(base=$scope.filters)[key]?base[key]:base[key]=[]),index=values.indexOf(value),index>-1)values.splice(index,1),new_values=values;else{for(new_value=value,new_value_type="",added=!1,$scope.FACETS=$scope.FACETS||[],ref=$scope.FACETS,j=0,len=ref.length;j<len;j++)if(item=ref[j],item.filter_type===key)for(ref1=item.filters,l=0,len1=ref1.length;l<len1;l++)filter=ref1[l],filter.value===value&&(new_value_type=item.slug);for(m=0,len2=values.length;m<len2;m++){for(existing_value=values[m],existing_values=existing_value.toString().split(","),first_value=existing_values[0],first_value_type="",ref2=$scope.FACETS,n=0,len3=ref2.length;n<len3;n++)if(item=ref2[n],item.filter_type===key)for(ref3=item.filters,o=0,len4=ref3.length;o<len4;o++)if(filter=ref3[o],filter.value===first_value){first_value_type=item.slug;break}new_value_type===first_value_type?(new_index=existing_values.indexOf(value),new_index>-1?existing_values.splice(new_index,1):existing_values.push(value),new_value=existing_values.join(","),new_values.push(new_value),added=!0):new_values.push(existing_value)}added||new_values.push(new_value)}$scope.filters[key]=new_values,$scope.update_expanded_filters(key)}},clear_filter:function(key){var filter;return filter=$scope.filters[key],$scope.filters[key]=_.isArray(filter)?[]:null,$scope.update_expanded_filters(key)},clear_all_filters:function(){var k,ref,results1,v;ref=$scope.FACETS,results1=[];for(k in ref)v=ref[k],results1.push(this.clear_filter(v.filter_type));return results1},has_results:function(filter_group){return _.some(filter_group.filters,"count")},get_more_results:function(search){if(search.current_filters&&!$scope.is_loading&&search.show_all_results&&!search.no_more_results)return $scope.is_loading=!0,search.current_filters.page=search.current_filters.page||2,search.current_filters.page_size=search.page_size||12,search.query(search.current_filters).then(function(new_results){if(search.results=_.union(search.results,new_results),$scope.is_loading=!1,search.current_filters.page++,new_results.length<search.current_filters.page_size)return search.no_more_results=!0})},refocus_needle:function(e){return e.preventDefault(),needle_input.focus(),$scope.needle_has_focus=!0},is_filtering:function(key,value){var ref;return(null!=(ref=$scope.expanded_filters[key])?ref.indexOf(value):void 0)>-1},user_can_see_filter:function(filter_value){var is_authenticated,is_parent,is_student,ref,ref1,ref2;if(is_authenticated=!!$scope.user.is_authenticated,is_student=!!(null!=(ref=$scope.user)?ref.student:void 0),"Power Words"===filter_value){if(is_parent="parent"===(null!=(ref1=$scope.user)&&null!=(ref2=ref1.teacher)?ref2.role:void 0),!is_authenticated||is_parent)return!1;if(is_student&&!hasActivePowerWordsLicense($scope.user)&&!hasActiveProSubscription($scope.user))return!1}else if("Lesson Sparks"===filter_value&&(!is_authenticated||is_student))return!1;return!0}},NEW_FILTERS=[],EDUCATOR_ONLY_FILTERS=[],{is_new:function(filter_value){return indexOf.call(NEW_FILTERS,filter_value)>=0},is_student_viewable:function(filter_value){return indexOf.call(EDUCATOR_ONLY_FILTERS,filter_value)<0},has_inset_search:!isXsScreen()&&IsInsetSearch,execute_searches:!SkipSearches,set_inset_has_mouse:function(has_mouse){return $scope.inset_has_mouse=has_mouse},show_inset_search:function(){return $scope.inset_has_mouse||$scope.needle_has_focus},get_tooltip_title:function(value){var tooltip_titles;return tooltip_titles={content_maturities:"Filter to find articles Newsela recommends for each age group, based on the subject matter and background knowledge required for reading.",elementary:"Newsela Elementary articles are generally appropriate for younger readers.",grade_levels:"Filter to find articles that include a version written at a specific reading level.",power_words:"Articles with Power Words have 5 embedded vocabulary words."},tooltip_titles[value]}},BETA_FILTER_GROUP_NAMES=["suggested for"],{get_beta_label:function(filter_group_display_name){var label,ref;return ref=_.lowerCase(filter_group_display_name),label=indexOf.call(BETA_FILTER_GROUP_NAMES,ref)>=0?"beta":""}}),timeout_promise=null,$scope.set_needle_has_focus=function($event,is_field_focused){var is_target_search_button,is_target_search_input,within_form;return is_field_focused?$scope.needle_has_focus=!0:(is_target_search_button=$($event.relatedTarget).hasClass("fa-search"),is_target_search_input=$($event.relatedTarget).hasClass("search-input"),(within_form=is_target_search_input||is_target_search_button)?void 0:$scope.needle_has_focus=!1)},needle_input=angular.element("#masthead .search input[type=search]"),magnifying_glass=angular.element("#masthead .search .fa-search"),sanitized_needle=function(){return needle_input.val().replace(/^\s+|\s+$/gm,"")},handle_search_term=function(event_type){var event_description,event_name,kinesis_properties,navigate_to_search,search_term;return search_term=$scope.saved_needle||sanitized_needle(),event_description="Search Term Submitted",event_name="inset_search",kinesis_properties={event_description:event_description,search_term:search_term},$scope.filters.needle=search_term,$scope.querystring=$httpParamSerializer($scope.filters),navigate_to_search=function(){return location.href="/search/#/?"+$scope.querystring},send_to_kinesis(event_name,event_type,kinesis_properties),send_to_ga(event_name,event_type,event_description),$timeout(navigate_to_search,300)},magnifying_glass.on("click",function(e){return handle_search_term("click")}).on("keydown",function(e){if(13===e.keyCode)return handle_search_term("click")}),needle_input.on("keydown",function(e){if(9!==e.keyCode){if(13===e.keyCode){if(!IsInsetSearch)return;return handle_search_term("keydown")}return timeout_promise&&$timeout.cancel(timeout_promise),timeout_promise=$timeout(function(){return $scope.filters.needle=sanitized_needle()},500),$scope.is_search_started=!0}}).val($scope.filters.needle),get_cleaned_filters=function(filters){var key,ref,value;filters={},ref=$scope.filters;for(key in ref)value=ref[key],is_empty(value)||(filters[key]=value);return filters},is_empty=function(value){return angular.isArray(value)&&0===value.length||"string"==typeof value&&0===value.length||null==value},search_labels=_.map($scope.searches,"label"),indexOf.call(search_labels,"Articles")>=0&&ArticleLike.query().$promise.then(function(response){return $scope.user_article_likes=response}),text_set_search_labels=["Collections","Text Sets","Topics","Units"],_.intersection(search_labels,text_set_search_labels).length>0&&TextSetLike.query().$promise.then(function(response){return $scope.user_text_set_likes=response}),get_latest_article_suggestions=function(){if(!$scope.suggestion_searches.latest_articles.fetched)return $scope.suggestion_searches.latest_articles.query().then(function(suggested_results){$scope.suggestion_searches.latest_articles.fetched=!0,$scope.suggestion_searches.latest_articles.results=suggested_results})},get_suggested_results=function(){return $scope.user.is_authenticated?$scope.suggestion_searches.recently_viewed_articles.fetched?void 0:$scope.suggestion_searches.recently_viewed_articles.query().then(function(suggested_results){return $scope.suggestion_searches.recently_viewed_articles.fetched=!0,0===suggested_results.length?get_latest_article_suggestions():void($scope.suggestion_searches.recently_viewed_articles.results=suggested_results)}):get_latest_article_suggestions()},trigger_search=function(){var filters,filtersByObject,fn,generalFilters,headerFilters,j,len,next_querystring,page_size,ref,ref1,ref2,ref3,search,searches_in_flight,textSetFilters,topicAndUnitFilters,total_results;if(filters=get_cleaned_filters($scope.filters),next_querystring=$httpParamSerializer($scope.filters),$scope.filters&&next_querystring!==$scope.querystring)for($scope.querystring=next_querystring,$scope.is_loading=!0,$scope.has_inset_search||$location.search(_.omit(filters,"category","categories","format","rule","required_tag","subject","subjects","social_tag","story_type","story_types","text_set_types","tags","user_id")),total_results=0,searches_in_flight=0,ref=$scope.searches,fn=function(search){var parameters,relevantFilters;return relevantFilters=generalFilters.concat(filtersByObject[search.label]),parameters=_.pick($scope.parameters,relevantFilters),search.promise=search.query(parameters).then(function(results){if(next_querystring===$scope.querystring)return search.results=results,total_results+=results.length,IsInsetSearch?void 0:$scope.$emit("$stateChangeSuccess")})["catch"](function(){if(next_querystring===$scope.querystring)return search.results=null})["finally"](function(){next_querystring===$scope.querystring&&0===--searches_in_flight&&($scope.is_loading=!1,$scope.total_results=total_results,0===$scope.total_results&&get_suggested_results())})},j=0,len=ref.length;j<len;j++)if(search=ref[j],"Collections"!==search.label||$scope.user_may_search_collections)search.results=[],searches_in_flight++,page_size=null!=(ref1=search.page_size)?ref1:3,$scope.has_inset_search||search.page_size||(page_size=4*page_size),$scope.parameters=angular.extend({},filters,{page_size:page_size,size:page_size}),search.current_filters=$scope.parameters,search.no_more_results=!1,"Collections"===search.label&&($scope.parameters.collection_ids=$scope.collection_ids.join()),("Text Sets"===(ref2=search.label)||"Topics"===ref2||"Units"===ref2)&&(null!=(ref3=$scope.collection_ids)?ref3.length:void 0)>0&&($scope.parameters.exclude_collection_ids=$scope.collection_ids.join()),generalFilters=["needle","objects","facets","format","page_size","size","audiences","languages","subjects","tags","rule","collection_ids","exclude_collection_ids"],headerFilters=["categories","content_maturities","content_providers","features","grade_levels","reading_skills","story_types","required_tag"],textSetFilters=["include_article_headers","include_likes","include_user_likes","text_set_types","tag","types"],topicAndUnitFilters=["subject","tiles","text_set_type","type"],filtersByObject={Articles:headerFilters,"Text Sets":textSetFilters,Collections:textSetFilters,Topics:topicAndUnitFilters,Units:topicAndUnitFilters,Pages:[]},fn(search);else if(1===$scope.searches.length)return $scope.is_loading=!1,void($scope.total_results=0)},ref=$location.search();for(key in ref)if(value=ref[key],_.isArray(value))for(j=0,len=value.length;j<len;j++)nested_val=value[j],$scope.assign_filter(key,nested_val);else $scope.assign_filter(key,value);return $scope.user=User.me(),$scope.user.$promise.then(function(user){var MATURITY_BANDS,band,i,params,preferredGradeRange,ref1,ref2,ref3,ref4,ref5,ref6,ref7,ref8;if($scope.READING_STANDARDS=_.filter(READING_STANDARDS,function(s){return s.slug.startsWith(user.reading_standards||"cc")}),user.is_authenticated){if($scope.collection_ids=[],angular.forEach(user.licensed_collections,function(collection,index){return $scope.collection_ids.push(collection.id)}),$scope.user_may_search_collections=!!((null!=(ref1=$scope.collection_ids)?ref1.length:void 0)>0&&(null!=(ref2=user.content_search_permissions)?ref2.collection:void 0)),$scope.display_show_all_results=!1,params={name:"show_all_results_header",user_id:"me"},StudySegment.get(params,function(response){if("on"===response.segment)return $scope.display_show_all_results=!0}),(null!=(ref3=user.teacher)?ref3.lowest_preferred_grade_level:void 0)&&(null!=(ref4=user.teacher)?ref4.highest_preferred_grade_level:void 0)){for($scope.clear_filter("content_maturities"),preferredGradeRange=[],i=null!=(ref5=user.teacher)?ref5.lowest_preferred_grade_level:void 0;i<=(null!=(ref6=user.teacher)?ref6.highest_preferred_grade_level:void 0);)preferredGradeRange.push(i),i++;MATURITY_BANDS=window.CONTENT_MATURITY_GRADE_LEVELS;for(band in MATURITY_BANDS)ref7=MATURITY_BANDS[band][0],indexOf.call(preferredGradeRange,ref7)>=0&&(ref8=MATURITY_BANDS[band][1],indexOf.call(preferredGradeRange,ref8)>=0)&&$scope.assign_filter("content_maturities",band)}}else $scope.user_may_search_collections=!1;if($scope.execute_searches)return $scope.$watch("filters",trigger_search,!0)}),$scope.has_inset_search&&($scope.saved_needle=null,$scope.$watch("show_inset_search()",function(show_inset_search){var ref1;return show_inset_search===!1?($scope.saved_needle=sanitized_needle(),needle_input.val("")):(null!=(ref1=$scope.saved_needle)?ref1.length:void 0)?(needle_input.val($scope.saved_needle),$timeout(function(){return needle_input.select()})):void 0})),send_to_kinesis=function(event_name,event_type,properties){var kinesis_data;return properties.source_url=$location.absUrl(),$scope.filters&&(properties.preview_filters=$scope.filters),kinesis_data={user_id:$scope.user.id,date_created:moment.utc().format("YYYY-MM-DD HH:mm:ss"),event_name:event_name,event_type:event_type,properties:properties},"undefined"!=typeof tracker&&null!==tracker?tracker.send_to_kinesis("user-events",kinesis_data):void 0},send_to_ga=function(event_name,event_type,event_description){return"function"==typeof ga?ga("send","event",event_name,event_type,event_description):void 0}}),module.directive("searchResult",function($compile){return{restrict:"A",scope:{search:"=",result:"="},link:function(scope,element){return element.html(scope.search.template),$compile(element.contents())(scope)}}}),module.directive("filterMultiselect",function($location){return{restrict:"A",scope:{model:"=filterMultiselect"},controller:function($scope){return null==$scope.model?$scope.model=[]:angular.isArray($scope.model)||($scope.model=[$scope.model]),$scope.toggle=function(value){var index;return index=$scope.model.indexOf(value),index>-1?$scope.model.splice(index,1):$scope.model.push(value)},$scope.is_selected=function(value){return $scope.model.indexOf(value)>-1}},link:function(scope,element,attrs){var checkboxes;return checkboxes=element.find("input[type=checkbox]").each(function(){var cb;return cb=angular.element(this),cb.prop("checked",scope.model.indexOf(cb.val())>-1)}),checkboxes.on("change",function(){return scope.model.splice(0,scope.model.length),checkboxes.filter(":checked").each(function(){return scope.model.push(this.value)}),scope.$apply()})}}}),module.directive("swallowScroll",function(){return{restrict:"A",link:function(scope,element){return element.on("scroll",function(e){return e.stopPropagation()})}}}),module.directive("fieldset",function(){return{restrict:"E",scope:{legend:"="},link:function(scope,element,attrs){var closed_by_default,current_key,ref,storage_key;return closed_by_default=["Format","Content Provider"],storage_key=["filter","state","browse_and_filter",scope.legend].join(":"),current_key=lscache.get(storage_key),"open"===current_key?element.hasClass("open")||element.addClass("open"):null===current_key&&(ref=scope.legend,indexOf.call(closed_by_default,ref)<0&&element.addClass("open")),element.find("legend").on("click",function(){return element.hasClass("open")?(element.removeClass("open"),lscache.set(storage_key,"closed")):(lscache.set(storage_key,"open"),element.addClass("open"))})}}})}).call(this);