(function(){var modalTransition,module,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};module=angular.module("newsela-common"),module.config(function($sceDelegateProvider){return $sceDelegateProvider.resourceUrlWhitelist(["self","https://d284gedng9vuu0.cloudfront.net/**","https://newsela-media.s3.amazonaws.com/**","https://newsela-media-dev.s3.amazonaws.com/**","https://media.newsela.com/**","https://static.newsela.com/**","https://nails.newsela.com/**"])}),module.run(function($rootScope,$window){return $rootScope.$on("$stateChangeSuccess",function(){var ref,ref1;return null!=(ref=$window.newsela)&&null!=(ref1=ref.sessionActivity)?ref1.trackPageView($window.location):void 0})}),modalTransition=function($element){return $element.on("show.bs.modal",function(e){return angular.element(".modal-dialog").velocity("transition.slideUpIn",500)})},window.isObjectArchived=function(thing){var archivedDate,today;return null!==thing.date_archived&&(today=moment(),archivedDate=moment(thing.date_archived),archivedDate.isBefore(today)||archivedDate.isSame(today))},module.factory("ArticleHeader",function($resource,$http,API_BASE_URL){return $resource(API_BASE_URL+"/articleheader/:id/",null,{get_by_slug:{url:API_BASE_URL+"/articleheader/:slug/",method:"GET"}})}),module.factory("ArticleHeaderClassroom",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/article-header-classroom/:id")}),module.factory("ArticleLike",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/articlelike/:id/")}),module.factory("Category",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/category/:tag_value/")}),module.factory("Classroom",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/classroom/:id/",{},{query_by_user:{url:API_BASE_URL+"/user/:user_id/classroom",method:"GET",isArray:!0,cache:!0}})}),module.factory("ContentRule",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/content-rule/:model_name/:slug/")}),module.factory("District",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/district/:id/")}),module.factory("DistrictLeader",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/district-leader/:id/")}),module.factory("GoogleClassroom",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/google-classroom/")}),module.factory("GoogleClassroomSync",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/google-classroom-sync/")}),module.factory("Group",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/user/:user_id/group/:group_name/")}),module.factory("HouseAd",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/house-ad/:id/")}),module.factory("Campaign",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/campaign/:id/")}),module.factory("ContentSearch",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/search/",null,{query:{method:"GET",isArray:!0,cache:!0,transformResponse:function(data){return angular.fromJson(data).tiles}}})}),module.factory("SearchService",function($resource,SEARCH_SERVICE_URL){return $resource(SEARCH_SERVICE_URL+"/v1/",null,{get:{withCredentials:!0}})}),module.factory("Invitation",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/invitation/:invitation_code")}),module.factory("MergeRequest",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/merge-request/")}),module.factory("Notification",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/notification/",null,null,{stripTrailingSlashes:!1})}),module.factory("Permission",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/user/:user_id/permission/:name/",null,{get:{method:"GET",isArray:!1,cache:!0}})}),module.factory("Principal",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/principal/:id/")}),module.factory("Stream",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/stream/:name/",{name:"@name"})}),module.factory("Quiz",function($resource,$http,API_BASE_URL){return{resource:$resource(API_BASE_URL+"/quiz/:id/",null,{get_by_article_id:{url:API_BASE_URL+"/article/:id/quiz",method:"GET"}}),get:function(params,success,error){return this.resource.get(params,success,error)},get_by_article_id:function(params,success,error){return this.resource.get_by_article_id(params,success,error)},post:function(data,config){var url;return url=API_BASE_URL+"/quiz/",data.id&&(url+=""+data.id),$http.post(url,data,config)}}}),module.factory("QuizQuestion",function($resource,$http,API_BASE_URL){return{resource:$resource(API_BASE_URL+"/quiz/:quizId/question/:id"),get:function(params,success,error){return this.resource.get(params,success,error)},post:function(data,config){var url;if(null===data.quiz_id)throw error("Object passed into QuizQuestion does not contain enough information to construct an API URL.");return url=API_BASE_URL+"/quiz/"+data.quiz_id+"/question/",data.id&&(url+=data.id+"/"),$http.post(url,data,config)}}}),module.factory("QuizQuestionChoice",function($resource,$http,API_BASE_URL){return{resource:$resource(API_BASE_URL+"/quiz/:quizId/question/:questionId/choice/:id"),get:function(params,success,error){return this.resource.get(params,success,error)},post:function(data,config){var url;if(null===data.quiz_question_id||null===data.quiz_id)throw error("Object passed into QuizQuestion does not contain enough information to construct an API URL.");return url=API_BASE_URL+"/quiz/"+data.quiz_id+"/question/"+data.quiz_question_id+"/choice/",data.id&&(url+=data.id+"/"),$http.post(url,data,config)}}}),module.factory("QuizQuestionFeedback",function($resource,$http,API_BASE_URL){return $resource(API_BASE_URL+"/quiz/:quiz_id/question/:question_id/feedback/:id",null,{query:{method:"GET",isArray:!0,cache:!0}})}),module.factory("QuizQuestionFlag",function($resource,$http,API_BASE_URL){return $resource(API_BASE_URL+"/quiz/:quiz_id/question/:question_id/flag/:id")}),module.factory("ArticleWord",function($resource,$http,API_BASE_URL){return $resource(API_BASE_URL+"/article-word/:id/",{id:"@id"})}),module.factory("Referral",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/referral/")}),module.factory("School",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/school/:id/")}),module.factory("SchoolActiveTeachers",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/school-active-teachers",{})}),module.factory("SchoolArticlesReadGraph",function($filter,$resource,addMissingDataXY,getProficiencyColor,API_BASE_URL,GRAPH_OPTIONS){var SchoolArticlesReadGraph;return SchoolArticlesReadGraph=$resource(API_BASE_URL+"/school-articles-read-graph",{},{get:{transformResponse:function(data,headersGetter,status){var tickValues,yMax;return 200===status&&(data=JSON.parse(data),yMax=0,tickValues=[],data.graph=[],data.articles_read.length>0&&(yMax=addMissingDataXY(data.articles_read,SchoolArticlesReadGraph.monthly_students,yMax,tickValues),data.graph=[{values:data.articles_read.splice(0,12)}],data.yMax=yMax,data.tickValues=tickValues)),data}}}),SchoolArticlesReadGraph.getDefaultOptions=function(data){return{chart:{type:"lineChart",color:function(){return getProficiencyColor("Level 4")},forceY:[0,1.2*data.yMax],height:GRAPH_OPTIONS.height,margin:GRAPH_OPTIONS.margin,showLegend:!1,tooltip:GRAPH_OPTIONS.tooltip,xAxis:{showMaxMin:!1,tickValues:data.tickValues},yAxis:{ticks:7,tickFormat:function(d){return""}}}}},SchoolArticlesReadGraph}),module.factory("SchoolProficiencyGraph",function($resource,getProficiencyColor,API_BASE_URL,GRAPH_OPTIONS){var SchoolProficiencyGraph;return SchoolProficiencyGraph=$resource(API_BASE_URL+"/school-proficiency-graph",{},{get:{transformResponse:function(data,headersGetter,status){var item,j,len1,percent,proficient,ref,ref1,total;if(200===status){if(data=JSON.parse(data),ref=[0,0,0],total=ref[0],proficient=ref[1],percent=ref[2],data.graph=[],total=_.reduce(data.percent_proficient,function(memo,item){return memo+item.value},0),0!==total){for(ref1=data.percent_proficient,j=0,len1=ref1.length;j<len1;j++)item=ref1[j],"3"!==item.level&&"4"!==item.level||(proficient+=item.value),item.x="Level "+item.level+"||"+item.description,item.y=item.value/total;data.graph=[{values:data.percent_proficient.reverse()}],percent=proficient/total}data.total_proficient=percent}return data}}}),SchoolProficiencyGraph.getDefaultOptions=function(){return{chart:{type:"multiBarHorizontalChart",barColor:function(d,i){return getProficiencyColor("Level "+d.level)},forceY:[0,1],height:GRAPH_OPTIONS.height,showControls:!1,showLegend:!1,showValues:!0,tooltip:GRAPH_OPTIONS.tooltip,valueFormat:function(d){return d3.format("%")(d)},yAxis:{ticks:10,showMaxMin:!1}}}},SchoolProficiencyGraph}),module.factory("SchoolQuizzesTakenGraph",function($filter,$resource,addMissingDataXY,API_BASE_URL,GRAPH_OPTIONS){var SchoolQuizzesTakenGraph;return SchoolQuizzesTakenGraph=$resource(API_BASE_URL+"/school-quizzes-taken-graph",{},{get:{transformResponse:function(data,headersGetter,status){var yMax;return 200===status&&(data=JSON.parse(data),yMax=0,data.graph=[],data.quizzes_taken.length>0&&(yMax=addMissingDataXY(data.quizzes_taken,SchoolQuizzesTakenGraph.monthly_students,yMax),data.graph=[{values:data.quizzes_taken.splice(0,12).reverse()}],data.yMax=yMax)),data}}}),SchoolQuizzesTakenGraph.getDefaultOptions=function(data){return{chart:{type:"discreteBarChart",forceY:[0,1.2*data.yMax],height:GRAPH_OPTIONS.height,margin:GRAPH_OPTIONS.margin,tooltip:GRAPH_OPTIONS.tooltip,yAxis:{ticks:7,tickFormat:function(d){return""}}}}},SchoolQuizzesTakenGraph}),module.factory("SchoolSummary",function($filter,$resource,addMissingDataXY,getProficiencyColor,API_BASE_URL){return $resource(API_BASE_URL+"/school-summary",{},{get:{transformResponse:function(data,headersGetter,status){var current,date_month,diff,end,i,j,k,len,len1,monthly_student,monthly_students,normalized_monthly_students,oldest_month,ref,today,total;if(200===status){for(data=JSON.parse(data),total=0,monthly_students=data.graph_data.monthly_students,len=monthly_students.length,len>0&&(oldest_month=monthly_students[len-1],today=moment(),end=moment(oldest_month.label,"YYYY-M"),diff=today.diff(end),len=Math.ceil(moment.duration(diff).asMonths())),len<12&&(len=12),normalized_monthly_students=[],i=j=ref=len;j>=0;i=j+=-1)date_month=moment().subtract(i,"months").format("YYYY-M"),current=_.find(monthly_students,{label:date_month}),current||(current={label:date_month,value:total,total:total}),normalized_monthly_students.push(current);for(k=0,len1=normalized_monthly_students.length;k<len1;k++)monthly_student=normalized_monthly_students[k],total+=monthly_student.value,monthly_student.total=total;data.graph_data.monthly_students=normalized_monthly_students}return data}}})}),module.factory("SchoolTeachers",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/school-teachers",{})}),module.factory("CoTeacherInvite",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/coteacher-invite")}),module.factory("Session",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/session/")}),module.factory("StorySocialTag",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/articlestory/:story_id/socialtag/")}),module.factory("Student",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/student/:id/")}),module.factory("StudentClassroom",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/student-classroom/:id/",{},{"delete":{url:API_BASE_URL+"/classroom/:classroom_id/student/:student_id/",method:"DELETE"}})}),module.factory("StudentQuiz",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/studentquiz/",{},{query:{method:"GET",isArray:!0,cache:!0}},{date_start:"@date_start",date_end:"@date_end",classroom_id:"@classroom_id"})}),module.factory("StudentResponse",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/constructedresponseanswer/:id/",{id:"@id"},{query:{method:"GET",isArray:!0,cache:!0}})}),module.factory("StudySegment",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/user/:user_id/study-segment/:name/",{user_id:"@user_id",name:"@name"},{get:{method:"GET",isArray:!1,cache:!0}})}),module.factory("TextSet",function($resource,API_BASE_URL){var TextSet;return TextSet=$resource(API_BASE_URL+"/text-set/:id/",null,{query:{method:"GET",isArray:!0,cache:!0}}),TextSet.prototype.validate=function(user){var slug_pattern,validation_errors;return validation_errors=[],this.title&&""!==this.title||validation_errors.push("Title is a required field."),this.description&&""!==this.description||validation_errors.push("Description is a required field."),this.slug&&""!==this.slug||validation_errors.push("Slug is a required field."),user.is_staff&&(slug_pattern=/^[a-zA-Z0-9-]+$/,this.slug.match(slug_pattern)||validation_errors.push("You can only use 1-9, A-Z, and dashes in the slug field.")),validation_errors},TextSet}),module.factory("TextSetArticleHeader",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/text-set-article-header/",null,{remove:{url:API_BASE_URL+"/text-set/:text_set_id/article/:article_header_id",method:"DELETE"}})}),module.factory("TextSetLike",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/text-set-like/:id/",null)}),module.factory("Teacher",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/teacher/:id/",null)}),module.factory("TeacherLanguages",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/teacher-languages/",null)}),module.factory("TeacherSubjects",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/teacher-subjects/",null)}),module.factory("License",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/license/",null)}),module.factory("TourEvent",function($resource,API_BASE_URL){return $resource(API_BASE_URL+"/tour-event/")}),module.factory("Tour",function(TourEvent){var monkeypatch;return monkeypatch={_createProgressBar:function(self,progressLayer,buttonsLayer){var connectingBarLi,j,progressDiv,progressInnerLi,progressSpan,progressUlContainer,ref,step_num,stepsLength;for(self._options.showProgress&&(buttonsLayer.className+=" shift-up"),progressLayer.className="introjs-progress-bullets",progressUlContainer=document.createElement("ul"),stepsLength=self._introItems.length,step_num=j=0,ref=stepsLength;0<=ref?j<ref:j>ref;step_num=0<=ref?++j:--j)progressInnerLi=document.createElement("li"),progressDiv=document.createElement("div"),progressSpan=document.createElement("span"),progressInnerLi.setAttribute("introjs-progress-bullet",step_num),progressInnerLi.className="progress-bullet",step_num<=self._currentStep&&(progressInnerLi.className+=" viewed",progressSpan.innerHTML='<i class="fa fa-check"></i>'),progressInnerLi.appendChild(progressDiv),progressDiv.appendChild(progressSpan),step_num>0&&(connectingBarLi=document.createElement("li"),connectingBarLi.setAttribute("introjs-progress-bullet-bar",step_num),connectingBarLi.className="connecting-bar",progressUlContainer.appendChild(connectingBarLi),step_num<=self._currentStep&&(connectingBarLi.className+=" viewed")),progressUlContainer.appendChild(progressInnerLi);return progressLayer.appendChild(progressUlContainer),progressUlContainer},_updateProgressBar:function(self,oldReferenceLayer){var connectingBarLi,innerLi,j,ref,step_num;for(step_num=j=0,ref=self._introItems.length;0<=ref?j<ref:j>ref;step_num=0<=ref?++j:--j)innerLi=oldReferenceLayer.querySelector('li[introjs-progress-bullet="'+step_num+'"]'),innerLi.className=step_num<=self._currentStep?"progress-bullet viewed":"progress-bullet",innerLi.querySelector("span").innerHTML=step_num<=self._currentStep?'<i class="fa fa-check"></i>':"",step_num>0&&(connectingBarLi=oldReferenceLayer.querySelector('li[introjs-progress-bullet-bar="'+step_num+'"]'),connectingBarLi.className=step_num<=self._currentStep?"connecting-bar viewed":"connecting-bar")}},function(tour_name){var tour;return tour=introJs(void 0,monkeypatch),tour.disableScrolling=function(){return tour.onchange(function(){return $(window).scrollTop(0),$("html, body").css("overflow","hidden")}),tour.onexit(function(){return $("html, body").css("overflow","visible")}),tour.oncomplete(function(){return $("html, body").css("overflow","visible")})},tour.setOptions({disableInteraction:!0,doneClass:"btn btn-primary",doneClassInsteadOfDefault:!0,doneLabel:"Got It",exitOnOverlayClick:!1,exitOnEsc:!1,headerHeight:$("#masthead").height(),keyboardNavigation:!1,nextLabel:'<span style="font-weight: bold;">Next <i class="fa fa-angle-right"></i></span>',padding:0,prevLabel:'<i class="fa fa-angle-left"></i> Back',showBackButton:!1,showBullets:!1,showHelperLayer:!1,showProgress:!0,showStepNumbers:!1,skipLabel:'<span style="font-size: 0.92em;">Skip Tour</span>'}),tour.onchange(function(element){return TourEvent.save({name:tour_name,step:tour.getStep()})}),tour.onexit(function(){return TourEvent.save({name:tour_name,step:tour.getStep(),is_skipped:!0})}),tour.oncomplete(function(){return TourEvent.save({name:tour_name,step:"complete"})})}}),module.factory("User",function($resource,$cacheFactory,MockResource,embedded_user,API_BASE_URL){var User;return User=$resource(API_BASE_URL+"/user/:id/",null,{get:{method:"GET",isArray:!1,cache:!0}}),User.clear_cache=function(){var cache;return cache=$cacheFactory.get("$http"),cache.removeAll(),embedded_user._dirty=!0},User.me=function(){var resource;return resource=null!==embedded_user&&embedded_user._dirty!==!0?MockResource(User,embedded_user):User.get({id:"me"}),"undefined"!=typeof Raven&&null!==Raven&&resource.$promise.then(function(me){return Raven.setUserContext(_.pick(me,["id","username","email","student","teacher","principal","district_leader","social_auth"]))}),resource},User}),module.factory("MockResource",function($q,$timeout){return function(resource,obj){var mock;return mock=new resource(obj),angular.extend(mock,{$promise:$timeout(function(){return $q.resolve(mock)}),$resolved:!0,$cancelRequest:function(){return null}}),mock}}),module.factory("BinderHelper",function($timeout,isProUser){var BinderHelper;return BinderHelper={},BinderHelper.is_nonapproved_principal_with_license=function(user){return isProUser(user)&&null!=user.principal&&!user.principal.is_pro_approved},BinderHelper.is_principal_without_license=function(user){return _.some(user.licenses,function(lic){return"pro"===lic.product})&&!isProUser(user)&&null!=user.principal},BinderHelper.scroll_top=function(){return $timeout(function(){return angular.element("body")[0].scrollTop=0},500)},BinderHelper.teacher_or_veil_link=function(user,school_id,teacher){var can_impersonate_teachers;return can_impersonate_teachers=null!=user.principal||null!=user.district_leader,can_impersonate_teachers?BinderHelper.is_nonapproved_principal_with_license(user)||BinderHelper.is_principal_without_license(user)?"/admin-binder/#/school/by_grade/"+school_id:"/pro-binder/assignments?user_id="+teacher.user.id:null},BinderHelper}),module.factory("QueryString",function($window){var QueryString;return QueryString={},QueryString.get=function(param){var j,kvp,len1,qs,value,vars;if(qs=$window.location.search.substring(1),!param)return qs;for(vars=qs.split("&"),j=0,len1=vars.length;j<len1;j++)if(value=vars[j],kvp=value.split("="),kvp[0].toLowerCase()===param.toLowerCase())return decodeURIComponent(kvp[1])},QueryString}),module.factory("resetAnnotationPositions",function(){return function(){angular.element(window).trigger("resize")}}),module.factory("addMissingDataXY",function(){return function(graph,students,yMax,tickValues){var avg,current,date,date_month,date_ms,empty,i,j,node,student;for(i=j=0;j<=11;i=++j)date=moment().subtract(i,"months"),date_ms=+date.format("x"),date_month=date.format("YYYY-M"),node=graph[i],student=_.find(students,{label:date_month}),0===student.total&&(student.total=1),node&&(avg=node.value/student.total,node.x=date_ms,node.y=avg,tickValues&&tickValues.push(date_ms),avg>yMax&&(yMax=avg)),current=_.find(graph,{label:date_month}),current||(empty={label:date_month,count:0,x:date_ms,y:0},graph.splice(i,0,empty));return yMax}}),module.factory("getSchoolYearStart",function(){return function(){var SCHOOL_YEAR_START_MONTH,now,offset,this_month,this_year;return SCHOOL_YEAR_START_MONTH=6,now=moment(),this_month=now.month(),this_year=now.year(),offset=0,this_month<SCHOOL_YEAR_START_MONTH&&(offset-=1),moment({year:this_year+offset,month:SCHOOL_YEAR_START_MONTH})}}),module.factory("getProficiencyColor",function(COLORS){return function(level){return"Level 1"===level?COLORS.RED:"Level 2"===level?COLORS.YELLOW:"Level 3"===level?COLORS.PURPLE:"Level 4"===level?COLORS.GREEN:void 0}}),module.factory("IntroJs",function(){return function(level){return"Level 1"===level?COLORS.RED:"Level 2"===level?COLORS.YELLOW:"Level 3"===level?COLORS.PURPLE:"Level 4"===level?COLORS.GREEN:void 0}}),module.factory("isXsScreen",function(){return function(){return angular.element("#masthead .hamburger").is(":visible")}}),module.factory("decorateWhileLoading",function(){return function(resource){return resource.$$loading=!0,resource.$promise["finally"](function(){return delete resource.$$loading}),resource}}),module.factory("hasActiveProSubscription",function(){return function(user){return _.some(user.licenses,function(license){return"pro"===license.product&&license.is_active&&license.is_subscription})}}),module.factory("hasActivePowerWordsLicense",function(){return function(user){return _.some(user.licenses,function(license){return"power_words"===license.product&&license.is_active})}}),module.factory("hasActiveCustomUnitsLicense",function(){return function(user){return _.some(user.licenses,function(license){return"custom_units"===license.product&&license.is_active})}}),module.factory("hasExpiredProSubscription",function(){return function(user){return _.some(user.licenses,function(license){return"pro"===license.product&&license.is_expired&&license.is_subscription})}}),module.factory("hasExpiredProTrial",function(){return function(user){return _.some(user.licenses,function(license){return"pro"===license.product&&license.is_expired&&license.is_trial})}}),module.factory("isProUser",function(){return function(user){return _.some(user.licenses,function(license){return"pro"===license.product&&license.is_active})}}),module.factory("isTrialUser",function(isProUser,hasActiveProSubscription){return function(user){return isProUser(user)&&!hasActiveProSubscription(user)}}),module.factory("getActiveAndFutureProLicenses",function(){return function(user){return _(user.licenses).filter({product:"pro"}).filter(function(lic){return moment(lic.date_ends).isAfter(new Date)}).sortBy(["date_ends"]).value()}}),module.factory("subscriptionDaysLeft",function(getActiveAndFutureProLicenses){return function(user){var licenses;return licenses=getActiveAndFutureProLicenses(user),_(licenses).map(function(lic){return moment(lic.date_ends).diff(moment(),"days")}).max()}}),module.factory("willExpireWithin30Days",function(subscriptionDaysLeft,getActiveAndFutureProLicenses){return function(user){var licenses;return licenses=getActiveAndFutureProLicenses(user),_.size(licenses)&&subscriptionDaysLeft(user)<30}}),module.factory("hasExpiredWithin90Days",function(subscriptionDaysLeft,getActiveAndFutureProLicenses){return function(user){var licenses;return licenses=getActiveAndFutureProLicenses(user),_.size(licenses)&&subscriptionDaysLeft(user)<90}}),module.directive("addressDisplay",function(GOOGLE_API_KEY){return{restrict:"E",templateUrl:"signup/address_display.html",scope:{entity:"="},link:function(scope){return scope.GOOGLE_API_KEY=GOOGLE_API_KEY}}}),module.directive("tile",function($window,$timeout,embedded_user,isProUser,STATIC_URL,ArticleLike,isXsScreen,TextSetLike,Tour,TourEvent,User,StudySegment,hasActivePowerWordsLicense,hasActiveProSubscription){return{restrict:"A",scope:{include_creator:"@?includeCreator",tile:"=",style:"@",clickEventName:"@",clickProperties:"="},templateUrl:function(element,attr){var template_url;return template_url="tile_"+attr.type+".html",attr.context?attr.context+"/"+template_url:template_url},controller:function($scope){return $scope.fallback_image_url=STATIC_URL+"images/tile-placeholder.png"},link:function(scope,element){var c,j,len1,ref,ref1,results,slug;if(User.me().$promise.then(function(user){if(scope.article_like_icon="fa-bookmark",scope.verb_for_article_like_icon="Save",embedded_user.is_authenticated&&embedded_user.teacher)return scope.verb_for_article_like_icon="Bookmark"}),scope.like_in_progress=!1,scope.tile&&(scope.tile.type||(scope.tile.type=scope.tile.thumbnail_images?"text_set":"article")),scope.toggle_like=function(){var like,ref,ref1,ref2;if(!scope.like_in_progress)return embedded_user.is_authenticated?(scope.like_in_progress=!0,like=(null!=(ref=scope.tile)?ref.like:void 0)||scope.like,null!=(null!=like?like.id:void 0)?"text_set"===(ref1=scope.tile.type)||"topic"===ref1||"unit"===ref1?TextSetLike.remove({id:like.id},function(){return like.id=null,scope.like_in_progress=!1}):ArticleLike.remove({id:like.id},function(){return like.id=null,scope.like_in_progress=!1}):"text_set"===(ref2=scope.tile.type)||"topic"===ref2||"unit"===ref2?TextSetLike.save({text_set_id:scope.tile.id},function(result){return like.id=result.id,scope.like_in_progress=!1,scope.show_centralized_save_page_tour("centralized_save_page_"+scope.tile.type)}):ArticleLike.save({header_id:scope.tile.id},function(result){return like.id=result.id,scope.like_in_progress=!1,scope.show_centralized_save_page_tour("centralized_save_page_header")})):void window.dispatchEvent(new Event("openSignInModal"))},scope.user_can_edit=function(){var ref;return!("text_set"!==(null!=(ref=scope.tile)?ref.type:void 0)||!embedded_user)&&(scope.tile.created_by?scope.tile.created_by.id===embedded_user.id:embedded_user.is_staff)},scope.user_is_pro_educator=function(){return!embedded_user.student&&isProUser(embedded_user)},scope.is_eligible_for_trial=function(){return!!embedded_user.is_eligible_for_trial},scope.track_click=function(){if(scope.clickEventName)return"undefined"!=typeof tracker&&null!==tracker?tracker.send_to_kinesis("user-events",{user_id:null!=embedded_user?embedded_user.id:void 0,date_created:moment.utc().format("YYYY-MM-DD HH:mm:ss"),event_type:"click",event_name:scope.clickEventName,properties:scope.clickProperties}):void 0},scope.show_centralized_save_page_tour=function(tour_name){var introText,step,steps,tour,tour_event;if(embedded_user&&embedded_user.is_authenticated&&!isXsScreen())return introText="Find everything you saved in <strong>Saved by You</strong>",steps=[{element:document.querySelector("#settings-buttons"),intro:introText,position:"bottom-right-aligned"}],tour=Tour(tour_name).disableScrolling().setOptions({showBullets:!1,showProgress:!1,steps:steps,tooltipClass:"centralized-save-page-tour"}),tour_event=_.get(embedded_user.tour_events,tour_name,{is_skipped:!1,step:1}),step=Number(tour_event.step),!tour_event.is_skipped&&!isNaN(step)&&tour_event.step<=steps.length?($(window).resize(function(){isXsScreen()&&(tour.enableScolling(),tour.exit())}),tour.goToStep(step).start(),embedded_user.tour_events[tour_name]={is_skipped:!0,step:"complete"}):void 0},scope.tile&&"article"===scope.tile.type){for(scope.tile.category_name=scope.tile.category?scope.tile.category.replace(/-/g," ").replace(/and/g,"&"):"",(null!=(ref=scope.tile.features)?ref.indexOf("power_words"):void 0)>-1&&((null!=embedded_user?embedded_user.student:void 0)&&!hasActivePowerWordsLicense(embedded_user)&&!hasActiveProSubscription(embedded_user)?scope.tile.has_power_words=!1:scope.tile.has_power_words=!0),scope.quiz_class="",ref1=scope.tile.anchor_standards_tested,results=[],j=0,len1=ref1.length;j<len1;j++)slug=ref1[j],c=" reading-standard-"+slug,scope.quiz_class+=c,results.push($timeout(function(){var id;return id="#"+scope.tile.slug,window.App.initialize_widgets(id)}));return results}}}}),module.directive("questionFlag",function(User,QuizQuestionFlag){return{restrict:"AE",templateUrl:"quiz_question_flag.html",scope:{questionId:"=",quizId:"="},link:function(scope,element){return scope.user=User.get({id:"me"},function(){if(scope.user.is_authenticated&&scope.user.teacher)return scope.user.can_add_quizquestionflag=!0,scope._query_param={question_id:scope.questionId,quiz_id:scope.quizId},scope.selected_flag=QuizQuestionFlag.get(scope._query_param)}),scope.options=[{message:"Incorrect answer"},{message:"No correct answer"},{message:"More than one correct answer"},{message:"Grammar and punctuation errors"},{message:"Not aligned with anchor standard"},{message:"Not appropriate for grade level"},{message:"Article content is confusing"}],scope._reset_panel=function(){var j,len1,option,ref,results;for(scope._show_options=!1,scope._has_hidden_confirmation=!0,ref=scope.options,results=[],j=0,len1=ref.length;j<len1;j++)option=ref[j],results.push(option.is_hovering=!1);return results},scope.show_options=function(){return scope._show_options},scope.toggle_options_panel=function(){return scope._show_options||$("#Quiz div").animate({scrollTop:1e3},1e3),scope._show_options=!0},scope.hide_options=function(){return scope._reset_panel()},scope.is_selected=function(flag_option){var ref;return flag_option.message===(null!=(ref=scope.selected_flag)?ref.message:void 0)},scope.hover_option=function(flag_option){var j,len1,option,ref;for(ref=scope.options,j=0,len1=ref.length;j<len1;j++)option=ref[j],option.message!==flag_option.message&&(option.is_hovering=!1);return flag_option.is_hovering=!0},scope.submit_option=function(flag_option){return scope.selected_flag=flag_option,scope._reset_panel(),scope._has_hidden_confirmation=!1,scope._has_submitted_flag=!0,QuizQuestionFlag.save(scope._query_param,flag_option)},scope.delete_option=function(flag_option){return QuizQuestionFlag["delete"](scope._query_param,flag_option,function(){return scope.selected_flag=null,scope._has_submitted_flag=!1,scope._show_options=!0})},scope.hide_confirmation_panel=function(){return scope._has_hidden_confirmation=!0},scope.show_confirmation_panel=function(){return scope._has_submitted_flag&&!scope._has_hidden_confirmation}}}}),module.directive("questionFeedback",function(Permission,User,QuizQuestionFeedback){return{restrict:"AE",templateUrl:"quiz_question_feedback.html",scope:{questionId:"=",quizId:"="},link:function(scope,element){var get_reviewer_feedback;return scope.reviewer_feedback=[],get_reviewer_feedback=function(){return scope.query_param={question_id:scope.questionId,quiz_id:scope.quizId},scope.reviewer_feedback=QuizQuestionFeedback.query(scope.query_param)},scope.user=User.get({id:"me"},function(){var article_dom,params,user;if(scope.user.is_authenticated)return article_dom=angular.element("#Article").data(),user=scope.user,params={user_id:"me",article_id:article_dom.id},user.is_authenticated&&!user.is_wire_admin&&(params.name="articles.add_quizquestionfeedback",Permission.get(params,function(){return user.can_add_quizquestionfeedback=!0,get_reviewer_feedback()}),user.is_wire_contributor&&(params.name="articles.view_quizquestionfeedback",Permission.get(params,function(){return user.can_view_quizquestionfeedback=!0,get_reviewer_feedback()}))),user.is_wire_admin?(user.can_view_quizquestionfeedback=!0,user.can_add_quizquestionfeedback=!0,get_reviewer_feedback()):void 0}),scope.get_author=function(feedback){var ref;return(null!=(ref=feedback.reviewer)?ref.first_name:void 0)&&scope.user.is_wire_admin?feedback.reviewer.first_name:"Reviewer Comments"},scope.get_existing_active_feedback=function(){var f,j,len1,ref;for(ref=scope.reviewer_feedback||[],j=0,len1=ref.length;j<len1;j++)if(f=ref[j],f.reviewer_id===scope.user.id&&!isObjectArchived(f))return f},scope.add_feedback=function(){var feedback;return feedback=scope.get_existing_active_feedback(),feedback||(feedback={reviewer_id:scope.user.id},scope.reviewer_feedback.push(feedback)),feedback.is_editing=!0},scope.save_feedback=function(feedback){
var response;return response=QuizQuestionFeedback.save(scope.query_param,feedback,function(){var current_time;return current_time=moment().format("hh:mm A"),feedback.success_msg="Saved at "+current_time+".",feedback.is_editing=!1,feedback.id=response.id})},scope.cancel_feedback_creation=function(feedback){return scope.reviewer_feedback=_.without(scope.reviewer_feedback,feedback)},scope.delete_reviewer_feedback=function(feedback,archive){var f;return null==archive&&(archive=!0),QuizQuestionFeedback["delete"]({question_id:scope.questionId,quiz_id:scope.quizId,id:feedback.id,archive:archive}),archive?feedback.date_archived=moment():scope.reviewer_feedback=function(){var j,len1,ref,results;for(ref=scope.reviewer_feedback,results=[],j=0,len1=ref.length;j<len1;j++)f=ref[j],f.id!==feedback.id&&results.push(f);return results}()},scope._show_archived_feedback=!1,scope.show_archived_feedback=function(){return scope._show_archived_feedback},scope.archive_feedback_message=function(){return scope._show_archived_feedback?"Hide archived feedback":"View archived feedback"},scope.archived_feedback_exists=function(){var archived_feedback,f,feedback;return feedback=scope.reviewer_feedback,!(!feedback||0===feedback.length)&&(archived_feedback=function(){var j,len1,results;for(results=[],j=0,len1=feedback.length;j<len1;j++)f=feedback[j],isObjectArchived(f)&&results.push(f);return results}(),null!=archived_feedback?archived_feedback.length:void 0)},scope.toggle_archived_feedback=function(){return scope._show_archived_feedback=!scope._show_archived_feedback}}}}),module.directive("searchField",function(){return{restrict:"AE",templateUrl:"search_field.html",scope:{placeholderText:"@",search:"=",searchFunction:"=",searchResults:"="},link:function($scope,element){return $scope.searching=!1,$scope.$watch("search",function(obj){return obj&&""!==obj?($scope.searchResults=null,$scope.searching=!0,$scope.searchFunction($scope.search).$promise.then(function(res){var current_input;if(current_input=element.find("input").get(0).value,obj===current_input)return $scope.searchResults=res,$scope.searching=!1})):$scope.searchResults=null})}}}),module.directive("addressTile",function(GOOGLE_API_KEY){return{restrict:"AE",templateUrl:"address_tile.html",scope:{select:"&",submit:"&",entity:"="},link:function($scope,$element,$attrs){return $scope.GOOGLE_API_KEY=GOOGLE_API_KEY}}}),module.directive("fullTextSearch",function($timeout,ContentSearch){return{restrict:"AE",templateUrl:"full_text_search.html",scope:{onResultClick:"&",placeholderText:"@",search:"="},link:function(scope,element,attrs){var timeout_promise;return scope.select_article=function(article,close){scope.onResultClick({data:article}),$("#search-result-list").removeClass("open")},scope.is_searching=!1,timeout_promise=null,scope.$watch("search",function(obj){if(scope.search)return timeout_promise&&(scope.is_searching=!1,$timeout.cancel(timeout_promise)),timeout_promise=$timeout(function(){var params;return $("#search-result-list").removeClass("open"),scope.is_searching=!0,params={needle:scope.search,tiles:!0},ContentSearch.query(params,function(result){return $("#search-result-list").addClass("open"),scope.search_results=result,scope.is_searching=!1})},500)}),scope.mousedown_article=function($event){return $event.preventDefault()}}}}),module.directive("addressSearch",function($timeout,District,School,GOOGLE_API_KEY){return{restrict:"AE",templateUrl:"address_search.html",scope:{onResultClick:"&",placeholderText:"@",objectType:"@",searchType:"@",search:"="},link:function(scope,element,attrs){return scope.GOOGLE_API_KEY=GOOGLE_API_KEY,scope.select_result=function(result){return scope.onResultClick({result:result})},scope.searchFunction=function(query){var attrName,params;return attrName="zip_code"===scope.searchType?"zip_code":"query",params={is_valid:!0},params[attrName]=query,"school"===scope.objectType?School.query(params):"district"===scope.objectType?District.query(params):void 0}}}}),module.directive("actionMessage",function($timeout,resetAnnotationPositions){return{restrict:"A",templateUrl:"action_message.html",transclude:!0,scope:{actionMessage:"="},link:function(scope,element,attrs){var timeout_promise;return timeout_promise=null,attrs.columns&&(scope.columns=attrs.columns),scope.$watch("actionMessage",function(obj){if(obj&&(element.slideDown("slow"),$timeout(resetAnnotationPositions,500)),timeout_promise&&$timeout.cancel(timeout_promise),null!=obj?obj.time:void 0)return timeout_promise=$timeout(function(){return element.slideUp("slow",function(){return scope.action_message=null,scope.$apply(),resetAnnotationPositions()})},"default"===obj.time?5e3:obj.time)})}}}),module.directive("largeCollapsibleDataTable",function($compile){return{restrict:"A",scope:{expandText:"@",headerDirective:"@",headerData:"=",headerText:"@",tableDirective:"@",tableData:"=",tableOpen:"=",user:"="},link:function(scope,element,attrs){var generatedTemplate;return generatedTemplate='<div class="lcdt" ng-class="{open: tableOpen}"> <div class="lcdt-header-area" ng-click="tableOpen = !tableOpen"> <div class="lcdt-header"> <h4>'+scope.headerText+'</h4> <br style="clear: both" /> </div> <div class="lcdt-header-data-area"> <'+scope.headerDirective+' data="headerData" /> </div> <div class="lcdt-expand-link" ng-if="tableData.length">'+scope.expandText+'</div> </div> <div class="classroom-detail" ng-show="tableOpen"> <div class="detail-table" ng-show="tableData.length"> <'+scope.tableDirective+' data="tableData" user="user" /> </div> </div> </div>',element.append($compile(generatedTemplate)(scope))}}}),module.directive("placeholder",function(){return{restrict:"",link:function(scope,element){return"function"==typeof element.placeholder?element.placeholder():void 0}}}),module.directive("tooltip",function(){return{link:function(scope,element){var ref,ref1;return"function"==typeof element.tooltip?element.tooltip({container:null!=(ref=element.attr("data-container"))?ref:element,placement:null!=(ref1=element.attr("data-placement"))?ref1:"top"}):void 0}}}),module.directive("popover",function(){return{link:function(scope,element){return"function"==typeof element.popover&&element.popover({trigger:"manual",html:!0}),element.on("mouseenter",function(){return element.popover("show")}),element.on("mouseleave",function(){return setTimeout(function(_this){return function(){if(!$(".popover:hover").length)return $(_this).popover("hide")}}(this),300)})}}}),module.directive("autoresize",function(){return{restrict:"A",link:function(scope,element){return angular.element(element).autosize(),scope.$watch(function(){setTimeout(function(){return element.trigger("autosize.resize")})}),scope.$on("autosize",function(){return element.trigger("autosize.resize")})}}}),module.directive("sortOn",function(){return{restrict:"A",link:function(scope,element,attrs){var compare_sorts,ref,ref1,reverse_attribute,sort_attribute;return sort_attribute=null!=(ref=attrs.sortAttribute)?ref:"sort",reverse_attribute=null!=(ref1=attrs.reverseAttribute)?ref1:"reverse",compare_sorts=function(a,b){var i;if(typeof a!=typeof b)return!1;if("object"==typeof a){if(a.length!==b.length)return!1;for(i in a)if(a[i]!==b[i])return!1;return!0}return a===b},element.is("th, .sortable")&&(element.addClass("sortable"),element.bind("click",function(){return scope.$apply(function(){return compare_sorts(scope[sort_attribute],attrs.sortOn)?scope[reverse_attribute]=!scope[reverse_attribute]:(scope[sort_attribute]=attrs.sortOn,scope[reverse_attribute]=!1)})})),scope.$watch(sort_attribute,function(sort){var ref2,reverse;return reverse=null!=(ref2=scope[reverse_attribute])&&ref2,compare_sorts(attrs.sortOn,sort)?(element.toggleClass("sorted-descending",reverse),element.toggleClass("sorted-ascending",!reverse)):element.removeClass("sorted-descending sorted-ascending")}),scope.$watch(reverse_attribute,function(reverse){if(compare_sorts(attrs.sortOn,scope[sort_attribute]))return element.toggleClass("sorted-descending",reverse),element.toggleClass("sorted-ascending",!reverse)})}}}),module.directive("writeScoreSm",function(){return{scope:{score:"@"},template:'<span class="write-score-sm" ng-show="score !== \'\' && score != null">\n  {{ (1.0 * score) + 1 }}\n</span>'}}),module.directive("writeScore",function(){return{scope:{score:"@"},template:'<span class="write-score" ng-show="score !== \'\' && score != null">\n  {{ (1.0 * score) + 1 }}\n</span>'}}),module.directive("arcVisualization",function(){return{link:function(scope,element,attrs){return attrs.$observe("arcVisualization",function(value){var background_arc,filled_arc,group,percent;if(percent=Number(value),element.find("svg.arc").remove(),(0===value||value)&&!isNaN(percent))return element.addClass("arc-visualization"),attrs.parentClass?element.parent().addClass(attrs.parentClass):(element.parent().toggleClass("good",percent>=.75),element.parent().toggleClass("fair",percent<.75&&percent>=.65),element.parent().toggleClass("poor",percent<.65)),filled_arc=d3.svg.arc().innerRadius(39).outerRadius(42).startAngle(0).endAngle(2*Math.PI*percent),background_arc=d3.svg.arc().innerRadius(39).outerRadius(42).startAngle(2*Math.PI*percent).endAngle(2*Math.PI),element.css("position","relative"),group=d3.select(element.get(0)).style("position","relative").append("svg").classed("arc",!0).attr("width",84).attr("height",84).style("position","absolute").style("top","-2px").style("left","3px").append("g").attr("transform","translate(42, 42)"),group.append("path").attr("d",background_arc).classed("background",!0),group.append("path").attr("d",filled_arc).classed("filled",!0)})}}}),module.directive("loader",function(){return{scope:{show:"&?loader"},template:'<div ng-show="show()" class="loader-container">\n  <div class="loader centered"></div>\n</div>',controller:function($scope){return null!=$scope.show?$scope.show:$scope.show=function(){return!0}}}}),module.directive("trimOnBlur",function(){return{restrict:"A",link:function(scope,element){return element.on("blur",function(){return this.value=null!=this.value?this.value.trim():""})}}}),module.directive("schoolChangeAgreementModal",function(){return{restrict:"AE",templateUrl:"settings/school_change/agreement_modal.html",scope:{user:"="},link:function($scope,$element,$attrs){return modalTransition($element)}}}),module.directive("schoolChangeEmailModal",function(){return{restrict:"AE",templateUrl:"settings/school_change/email_modal.html",scope:{user:"="},link:function($scope,$element,$attrs){return modalTransition($element)}}}),module.directive("schoolChangeErrorModal",function(){return{restrict:"AE",templateUrl:"settings/school_change/error_modal.html",scope:{user:"="},link:function($scope,$element,$attrs){return modalTransition($element)}}}),module.directive("classCodeWithCopyButton",function($timeout,$window){return{restrict:"AE",templateUrl:"class_code_with_copy_button.html",scope:{classroom:"="},link:function(scope,$element,$attrs){var clipboard,create_tooltip;return scope.get_copy_link=function(code){return window.location.protocol+"//"+$window.location.host+"/quickjoin/#/"+code},create_tooltip=function(element,message){var e;return e=angular.element(element).tooltip({title:message,trigger:"manual",container:"body"}),e.tooltip("show"),$timeout(function(){return e.tooltip("destroy")},3e3)},clipboard=new Clipboard(".copy-btn",{text:function(){return scope.get_copy_link(scope.classroom.class_code)}}),clipboard.on("success",function(e){return create_tooltip(e.trigger,"Copied!")}),clipboard.on("error",function(e){var action_key,action_message;return action_key="cut"===e.action?"X":"C",action_message=/Mac/i.test(navigator.userAgent)?"Press Cmd-"+action_key+" to "+e.action:"Press Ctrl-"+action_key+" to + e.action",create_tooltip(e.trigger,action_message)})}}}),module.directive("inviteStudentsModal",function(){return{restrict:"AE",templateUrl:"invite_students_modal.html",scope:{classroom:"="},link:function($scope,$element,$attrs){return modalTransition($element)}}}),module.directive("googleClassroomSyncModal",function(Classroom,GoogleClassroom,GoogleClassroomSync,$q,$window,GRADES,STATIC_URL){return{restrict:"AE",templateUrl:"google_classroom_sync_modal.html",scope:{onSyncComplete:"&",onHide:"&"},link:function(scope,element){return scope.GRADES=GRADES,scope.STATIC_URL=STATIC_URL,scope.complete=function(){return angular.element("#google-classroom-modal").modal("toggle"),scope.onSyncComplete()},scope.is_option_required=function(){var all_classes_marked_to_sync,newly_marked_classes;return all_classes_marked_to_sync=_.filter(scope.google_classrooms,{should_be_synced:!0}),newly_marked_classes=_.filter(all_classes_marked_to_sync,function(c){return!!c.is_synced==!1}),0===newly_marked_classes.length},element.on("show.bs.modal",function(){return scope.import_complete=!1,scope.is_loading=!0,angular.element(".modal-dialog").velocity("transition.slideUpIn",500),scope.google_classrooms=GoogleClassroom.query({hide_archived:!0},function(){return Classroom.query({hide_archived:!0},function(classrooms){var addl_properties,applicable_google_classroom,classroom,j,len1;for(j=0,len1=classrooms.length;j<len1;j++)classroom=classrooms[j],classroom.google_classroom_id&&(applicable_google_classroom=_.find(scope.google_classrooms,{id:classroom.google_classroom_id}),addl_properties={is_synced:!0,should_be_synced:!0,grade:classroom.grade,last_synced:classroom.date_modified},_.assign(applicable_google_classroom,addl_properties));return scope.is_loading=!1})},function(err){if(scope.is_loading=!1,403===err.status&&(scope.not_a_google_classroom_user=!0),401===err.status)return scope.not_authorized=!0,scope.next_url=encodeURIComponent("/settings/#/classrooms/provider/google-classroom")})}),element.on("hide.bs.modal",function(){return"function"==typeof scope.onHide?scope.onHide():void 0}),scope.submit=function(form){var classroom,j,len1,promises,ref;if(!form.$invalid){for(scope.is_submitting=!0,promises=[],ref=scope.google_classrooms,j=0,len1=ref.length;j<len1;j++)classroom=ref[j],classroom.should_be_synced&&promises.push(GoogleClassroomSync.save({},classroom).$promise);return $q.all(promises).then(function(){return scope.is_submitting=!1,scope.import_complete=!0})}}}}}),module.directive("isValidClassCode",function(Classroom){return{require:"ngModel",link:function(scope,element,attrs,ctrl){var ref;return ctrl.$setValidity("isValidClassCode",!1),(null!=(ref=scope.user.classroom)?ref.name:void 0)&&ctrl.$setValidity("isValidClassCode",!0),ctrl.$parsers.unshift(function(classcode){var params;return ctrl.$setValidity("isValidClassCode",!1),params={hide_archived:!0,code:classcode},scope.user.classroom=Classroom.get(params,function(){return ctrl.$setValidity("isValidClassCode",!0)}),classcode})}}}),module.directive("inputMatches",function(){return{require:"ngModel",scope:{other_model_value:"=inputMatches"},link:function(scope,element,attrs,model){return model.$validators.inputMatches=function(model_value){return model_value===scope.other_model_value},scope.$watch("other_model_value",function(){return model.$validate()})}}}),module.directive("submissionButton",function(STATIC_URL){return{restrict:"E",replace:"true",scope:{additionalClasses:"@",isSubmitting:"=",isDisabled:"=",submissionText:"@",text:"@"},template:'<button type="submit" class="btn btn-submission {{additionalClasses}}"> <span ng-bind="buttonText"></span> <img alt="Loading" class="loading" ng-if="isSubmitting" ng-src="{{ STATIC_URL }}images/loader.gif"></img> </button>',controller:function($scope){return $scope.additionalClasses=$scope.additionalClasses||"",$scope.submissionText=$scope.submissionText||"Submitting...",$scope.buttonText=$scope.text=$scope.text||"Submit",$scope.STATIC_URL=STATIC_URL},link:function(scope,element){return scope.$watch("isSubmitting",function(newValue){return newValue?(scope.buttonText=scope.submissionText,element.attr("disabled",!0).addClass("is-submitting")):(scope.buttonText=scope.text,element.attr("disabled",!1).removeClass("is-submitting"))}),scope.$watch("isDisabled",function(newValue){return newValue?element.attr("disabled",!0):element.attr("disabled",!1)})}}}),module.directive("separator",function(){return{restrict:"AE",replace:"true",template:'<div class="separator"> <div class="separator-circle"> <div class="separator-text">OR</div> </div> </div>'}}),module.directive("validDomains",function(USERNAME_REGEX){return{require:"ngModel",restrict:"A",scope:{validDomains:"="},link:function(scope,element,attrs,ngModel){return ngModel.$validators.validDomain=function(modelValue,viewValue){var at_symbol_index,domain;return!!viewValue&&(at_symbol_index=viewValue.lastIndexOf("@"),domain=viewValue.slice(at_symbol_index+1),indexOf.call(scope.validDomains,domain)>=0)}}}}),module.directive("validName",function(INVALID_NAME_REGEX){return{require:"ngModel",link:function(scope,element,attrs,ngModel){return ngModel.$validators.validName=function(modelValue,viewValue){return!INVALID_NAME_REGEX.test(viewValue)}}}}),module.directive("validEmail",function(EMAIL_REGEX){return{require:"ngModel",link:function(scope,element,attrs,ngModel){return ngModel.$validators.validEmail=function(modelValue,viewValue){return EMAIL_REGEX.test(viewValue)}}}}),module.directive("validUsername",function(USERNAME_REGEX){return{require:"ngModel",link:function(scope,element,attrs,ngModel){return ngModel.$validators.validUsername=function(modelValue,viewValue){return USERNAME_REGEX.test(viewValue)}}}}),module.directive("uniqueUsername",function(User,$q){return{require:"ngModel",link:function(scope,element,attrs,ngModel){return ngModel.$asyncValidators.uniqueUsername=function(modelValue,viewValue){return User.query({username:viewValue}).$promise.then(function(){return User.get({id:"me"}).$promise.then(function(logged_in_user){return logged_in_user.username===viewValue||$q.reject("Username is already taken.")},function(){return $q.reject("Username is already taken.")})},function(response){return 404===response.status})}}}}),module.directive("mdPasswordToggle",function(){return{restrict:"E",replace:!0,template:'<md-icon class="md-password-toggle" ng-click="toggle_input_type()">\n  <i class="fa"\n     ng-class="{ \'fa-eye\': show_open_eye_icon,\n          \'fa-eye-slash\': !show_open_eye_icon }"></i>\n  <span>{{ toggle_text }}</span>\n</md-icon>',link:function(_this){return function(scope,element,attrs){var input,md_input_container;return md_input_container=element.parent(),input=md_input_container.find(":password"),scope.toggle_text="Show",scope.show_open_eye_icon=!0,scope.toggle_input_type=function(){var current_type,new_type;current_type=input.attr("type"),new_type="password"===current_type?"text":"password",scope.toggle_text="password"===new_type?"Show":"Hide",scope.show_open_eye_icon="password"===new_type,input.attr("type",new_type)}}}(this)}}),module.directive("nsImage",function($q){return{restrict:"E",link:function(scope,element,attrs){var deferred,img;if(scope.error=!attrs.src,!scope.error)return deferred=$q.defer(),img=angular.element(new Image).attr("src",attrs.src),img.prop("complete")?deferred.resolve(img):(scope.loading=!0,img.bind("load",function(){return deferred.resolve(img)}).bind("error",function(){return deferred.reject(img)})),deferred.promise.then(function(){return element.children().remove(),element.append(img.removeAttr("width height"))})["catch"](function(){return scope.error=!0})["finally"](function(){return scope.loading=!1})}}}),module.directive("countdownTimer",function($interval){return{restrict:"AE",scope:{endDate:"="},link:function(scope,element,attrs){var update_intervals;return update_intervals=function(){var date_ends,delta,has_finished,intervals,now;return now=moment(),date_ends=moment(scope.endDate),has_finished=now>date_ends,delta=moment.duration(date_ends.diff(now)),intervals={seconds:Math.floor(delta.asSeconds()%60),minutes:Math.floor(delta.asMinutes()%60),hours:Math.floor(delta.asHours()%24),days:Math.floor(delta.asDays())},scope.minutes_left=has_finished?0:intervals.minutes,scope.hours_left=has_finished?0:intervals.hours},$interval(update_intervals,1e3)},template:"<strong>\n  <span ng-bind=hours_left></span>h\n  <span ng-bind=minutes_left></span>m\n</strong>"}}),module.directive("timer",function($interval){return{restrict:"AE",scope:{targetDate:"="},link:function(scope,element,attrs){var update_intervals;return scope.message=attrs.message,update_intervals=function(){var date_ends,delta,has_finished,intervals,now;return now=moment(),date_ends=moment(scope.targetDate),has_finished=now>date_ends,delta=moment.duration(date_ends.diff(now)),intervals={seconds:Math.floor(delta.asSeconds()%60),minutes:Math.floor(delta.asMinutes()%60),hours:Math.floor(delta.asHours()%24),days:Math.floor(delta.asDays())},scope.seconds_left=has_finished?0:intervals.seconds,scope.minutes_left=has_finished?0:intervals.minutes,scope.hours_left=has_finished?0:intervals.hours,scope.days_left=has_finished?0:intervals.days},$interval(update_intervals,1e3)},template:'<div class="timer">\n<h2 ng-bind="message"></h2>\n<div class="timer-face">\n  <div class="box">\n  <div ng-bind="days_left" class="count text-align">\n  </div>\n  <div class="time">\n    Days\n  </div>\n  </div>\n  <div class="box">\n  <div ng-bind="hours_left" class="count">\n  </div>\n  <div class="time">\n    Hours\n  </div>\n  </div>\n  <div class="box">\n  <div ng-bind="minutes_left" class="count">\n  </div>\n  <div class="time">\n    Minutes\n  </div>\n  </div>\n  <div class="box">\n  <div ng-bind="seconds_left" class="count">\n  </div>\n  <div class="time">\n    Seconds\n  </div>\n  </div>\n</div>\n</div>'}}),module.directive("probutton",function(){return{restrict:"A",template:'<span class="pro-mark-mini"> PRO </span>'}}),module.directive("stringToNumber",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModel){return ngModel.$parsers.push(function(value){return""+value}),ngModel.$formatters.push(function(value){return parseFloat(value,10)})}}}),module.filter("ordinal",function(){return function(number){var ordinal,v;return null!=number?(ordinal=["th","st","nd","rd"],v=number%100,ordinal[(v-20)%10]||ordinal[v]||ordinal[0]):""}}),module.filter("shortNumber",function($filter){return function(input,decimals){return input>999999999?$filter("number")(input/1e9,decimals)+"b":input>999999?$filter("number")(input/1e6,decimals)+"m":input>9999?$filter("number")(input/1e3,decimals)+"k":$filter("number")(input,decimals)}}),module.filter("htmlizeSafeTags",function($sanitize){return function(value){return $sanitize(value)}}),module.filter("markdown",function(){return function(text){return text?marked(text,{sanitize:!0}):""}}),module.filter("orderFiltersBy",function(){return function(items,sorted,field,filter_group_name){var groups_with_empty_last;return sorted?items:(groups_with_empty_last=["Content Provider"],_.sortBy(items,[function(x){return indexOf.call(groups_with_empty_last,filter_group_name)>=0?0===x.count:""},function(x){return/^\d+/.test(x[field])?Number(/^\d+/.exec(x[field])):""},function(x){return x[field]}]))}}),module.filter("searchFilterDisplay",["READING_STANDARDS",function(READING_STANDARDS){return function(item){var filter_display_names,standard;return filter_display_names={9.5:"9 - 10",11.5:"11 - 12"},filter_display_names[item]?filter_display_names[item]:_.isString(item)&&(item.startsWith("cc")||item.startsWith("teks"))?(standard=READING_STANDARDS[item],standard.short_code+": "+standard.title):item}}]),module.constant("EMAIL_REGEX",new RegExp(/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/)).constant("USERNAME_REGEX",new RegExp(/^[\w.@'+-^\S]+$/)).constant("INVALID_NAME_REGEX",new RegExp(/.*[!@#$%^&*()+=`~<>\/?\\\{\}\[\]].*/)).constant("STATES",[{code:"AL",name:"Alabama"},{code:"AK",name:"Alaska"},{code:"AZ",name:"Arizona"},{code:"AR",name:"Arkansas"},{code:"CA",name:"California"},{code:"CO",name:"Colorado"},{code:"CT",name:"Connecticut"},{code:"DE",name:"Delaware"},{code:"DC",name:"District Of Columbia"},{code:"FL",name:"Florida"},{code:"GA",name:"Georgia"},{code:"HI",name:"Hawaii"},{code:"ID",name:"Idaho"},{code:"IL",name:"Illinois"},{code:"IN",name:"Indiana"},{code:"IA",name:"Iowa"},{code:"KS",name:"Kansas"},{code:"KY",name:"Kentucky"},{code:"LA",name:"Louisiana"},{code:"ME",name:"Maine"},{code:"MD",name:"Maryland"},{code:"MA",name:"Massachusetts"},{code:"MI",name:"Michigan"},{code:"MN",name:"Minnesota"},{code:"MS",name:"Mississippi"},{code:"MO",name:"Missouri"},{code:"MT",name:"Montana"},{code:"NE",name:"Nebraska"},{code:"NV",name:"Nevada"},{code:"NH",name:"New Hampshire"},{code:"NJ",name:"New Jersey"},{code:"NM",name:"New Mexico"},{code:"NY",name:"New York"},{code:"NC",name:"North Carolina"},{code:"ND",name:"North Dakota"},{code:"OH",name:"Ohio"},{code:"OK",name:"Oklahoma"},{code:"OR",name:"Oregon"},{code:"PA",name:"Pennsylvania"},{code:"RI",name:"Rhode Island"},{code:"SC",name:"South Carolina"},{code:"SD",name:"South Dakota"},{code:"TN",name:"Tennessee"},{code:"TX",name:"Texas"},{code:"UT",name:"Utah"},{code:"VT",name:"Vermont"},{code:"VA",name:"Virginia"},{code:"WA",name:"Washington"},{code:"WV",name:"West Virginia"},{code:"WI",name:"Wisconsin"},{code:"WY",name:"Wyoming"}]).constant("MONTHS",["January","February","March","April","May","June","July","August","September","October","November","December"]).constant("COLORS",{GREEN:"#4ab471",PURPLE:"#B085EE",RED:"#CF5C60",YELLOW:"#ECCD41"}).constant("ERRORS",{field_required:"This is required.",name_invalid:"Please use your real name.",username_taken:"This username is already taken.",username_invalid:"Invalid username.",email_taken:"This email address is already taken.",email_invalid:"Invalid email address.",password_too_short:"Password must be longer than 6 characters.",classcode_invalid:"Invalid class code.",zipcode_invalid:"Invalid ZIP code.",school_name_required:"Enter school name (Ex. Park High School).",url_invalid:"Invalid URL."}).constant("GRAPH_OPTIONS",{height:460,margin:{top:20,right:20,bottom:80,left:60},tooltip:{enabled:!1}})}).call(this);